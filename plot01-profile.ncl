load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_code.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/wrf/WRFUserARW.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/gsn_csm.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/contributed.ncl"
load "$NCARG_ROOT/lib/ncarg/nclscripts/csm/shea_util.ncl"
load "/ncrc/home2/Yi-hsuan.Chen//script/ncl//ignorantNCL.ncl"
;load "./ignorantNCL.ncl"
load "/ncrc/home2/Yi-hsuan.Chen//script/ncl//ignorantNCL-colormaps.ncl"
;load "zz-read_parameters.ncl"

begin

  option = "BOMEX_original_MF"
  option = "BOMEX_MF_modUPA"

; --- BOMEX
  ZW  = (/       0.000  ,    36.468  ,    92.026  ,   168.825  ,   268.198  ,   393.711  ,   549.202  ,   739.933  ,   972.814  ,  1255.736  ,  1598.998  ,  2017.574  ,  2525.751  ,  3139.030  ,  3880.747  ,  4774.581  ,  5833.672  ,  7046.872  ,  8377.440  ,  9785.534  , 11247.469  , 12753.054  , 14297.461  , 15874.525  , 17478.190  , 19098.258  , 20774.759  , 22548.325  , 24441.285  , 26521.573  , 28962.856  , 32017.392  , 36212.473  , 44333.329  /)
  z_full  = (/   39363.480  , 33866.693  , 30357.993  , 27657.676  , 25419.995  , 23443.919  , 21616.863  , 19896.580  , 18251.761  , 16642.323  , 15054.492  , 13496.219  , 11973.629  , 10492.178  ,  9059.554  ,  7693.057  ,  6424.732  ,  5292.495  ,  4319.503  ,  3504.335  ,  2828.636  ,  2269.118  ,  1806.571  ,  1426.217  ,  1113.500  ,   855.852  ,   644.219  ,   471.226  ,   330.805  ,   218.418  ,   130.369  ,    64.218  ,    18.222  /)


if (option.eq."BOMEX_original_MF") then

  UPA = (/    0.4501E-02  ,  0.4501E-02  ,  0.4501E-02  ,  0.4501E-02  ,  0.4501E-02  ,  0.4501E-02  ,  0.4501E-02  ,  0.4501E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  UPW = (/    0.3204E+00  ,  0.4113E+00  ,  0.5569E+00  ,  0.7641E+00  ,  0.7641E+00  ,  0.1144E+01  ,  0.1572E+01  ,  0.3486E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  ENT = (/    0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.2013E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.3146E-02  ,  0.2576E-02  ,  0.1414E-02  ,  0.5826E-03  ,  0.1433E-02  ,  0.2361E-02  ,  0.3261E-03  ,  0.2157E-02  ,  0.1343E-02  ,  0.2455E-02  ,  0.1484E-02  ,  0.2104E-02  ,  0.2273E-02  ,  0.2189E-02  ,  0.2657E-02  ,  0.1683E-02  ,  0.2156E-02  ,  0.2120E-02  ,  0.1605E-02  ,  0.1670E-02  ,  0.1579E-02  ,  0.1690E-02  ,  0.2211E-02  ,  0.1638E-02  ,  0.2357E-02  ,  0.2050E-02  ,  0.1798E-02  /)
  DET = (/   -0.7781E-02  , -0.6284E-02  , -0.4751E-02  ,  0.2083E-02  , -0.3850E-02  , -0.2309E-02  ,  0.7244E-02  ,  0.6870E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)

elseif (option.eq."BOMEX_MF_modUPA_01") then
  UPA = (/    0.3208E-02  ,  0.4082E-02  ,  0.4665E-02  ,  0.4457E-02  ,  0.6841E-02  ,  0.9656E-02  ,  0.8580E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  UPW = (/    0.4042E+00  ,  0.3892E+00  ,  0.4179E+00  ,  0.5375E+00  ,  0.5267E+00  ,  0.5624E+00  ,  0.7829E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  ENT = (/    0.5484E-02  ,  0.3600E-02  ,  0.2604E-02  ,  0.4025E-02  ,  0.3187E-02  ,  0.1286E-02  ,  0.1049E-02  ,  0.2576E-02  ,  0.3535E-02  ,  0.2913E-02  ,  0.1911E-02  ,  0.1181E-02  ,  0.1631E-02  ,  0.1618E-02  ,  0.2014E-02  ,  0.1700E-02  ,  0.2803E-02  ,  0.1503E-02  ,  0.1989E-02  ,  0.1231E-02  ,  0.1860E-02  ,  0.2460E-02  ,  0.2156E-02  ,  0.1995E-02  ,  0.1975E-02  ,  0.2147E-02  ,  0.1692E-02  ,  0.1479E-02  ,  0.2115E-02  ,  0.2376E-02  ,  0.1506E-02  ,  0.1335E-02  ,  0.1724E-02  /)
  DET = (/   -0.5869E-03  , -0.3852E-03  , -0.2787E-03  , -0.9240E-03  , -0.7316E-03  , -0.1376E-03  ,  0.6292E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /) 

elseif (option.eq."BOMEX_MF_modUPA_02") then
  UPRHO = (/    0.1167E+01  ,  0.1163E+01  ,  0.1158E+01  ,  0.1151E+01  ,  0.1141E+01  ,  0.1130E+01  ,  0.1116E+01  ,  0.1097E+01  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  UPA = (/    0.3295E-02  ,  0.2680E-02  ,  0.3252E-02  ,  0.4882E-02  ,  0.3128E-02  ,  0.5089E-02  ,  0.7424E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  UPW = (/    0.3982E+00  ,  0.4912E+00  ,  0.4966E+00  ,  0.4966E+00  ,  0.7813E+00  ,  0.7238E+00  ,  0.7497E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)
  ENT = (/    0.0000E+00  ,  0.3600E-02  ,  0.5208E-02  ,  0.0000E+00  ,  0.3187E-02  ,  0.2572E-02  ,  0.3146E-02  ,  0.8588E-03  ,  0.2121E-02  ,  0.2331E-02  ,  0.2867E-02  ,  0.2755E-02  ,  0.2935E-02  ,  0.2157E-02  ,  0.2461E-02  ,  0.2266E-02  ,  0.1319E-02  ,  0.1804E-02  ,  0.1278E-02  ,  0.2462E-02  ,  0.1860E-02  ,  0.1813E-02  ,  0.2663E-02  ,  0.1372E-02  ,  0.1481E-02  ,  0.2267E-02  ,  0.2368E-02  ,  0.2113E-02  ,  0.2692E-02  ,  0.2376E-02  ,  0.2095E-02  ,  0.1859E-02  ,  0.1625E-02  /)
  DET = (/    0.7767E-17  , -0.3852E-03  , -0.1196E-02  ,  0.0000E+00  , -0.7316E-03  , -0.5905E-03  ,  0.8389E-02  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  ,  0.0000E+00  /)


else
 ; remove the space at the beginning    : [1,$s/^ */  /g]
 ; replace ",$" to "/)" at the end      : [1,$s/,$/\/)/g]
  
  print("ERROR: non support option "+option)
  exit

end if

  ZW = ZW(::-1)
    ZW@long_name = "Height"
    ZW@units     = "m"
  z_full = z_full
    z_full@long_name = "Height"
    z_full@units     = "m"
  UPA = UPA(::-1)
    UPA@long_name = "updraft fraction"
    UPA@units     = "none"
  UPW = UPW(::-1)
    UPW@long_name = "updraft velocity"
    UPW@units     = "m/s"
  ENT = ENT(::-1)*1000.
    ENT@long_name = "entainment rate"
    ENT@units     = "1/km"
  DET = DET(::-1)*1000.
    DET@long_name = "dentainment rate"
    DET@units     = "1/km"

  ENTmDET = diff(ENT,DET)
    ENTmDET@long_name = "entainment minus detrainment"
    ENTmDET@units     = ENT@units

  MF=UPA*UPW*UPRHO(::-1)
    MF@long_name = "mass flux"
    MF@units     = "kg/m2/s"

;------------------
; general settings
;------------------

  wks_name = "test111" + "-" + option
  wks_type = "png"  ; or x11,pdf,ncgm
  wks = gsn_open_wks(wks_type, wks_name)
  res = True
    res@xyMonoMarkLineMode = True
    res@xyMarkLineMode  = "MarkLines"

  res_xy1 = res

    res_xy1@gsnFrame = False
    res_xy1@gsnDraw = False
    res_xy1@gsnXRefLine = 0.

    res_xy1@trYMinF = 0.
    res_xy1@trYMaxF = 1200.

    ;res_xy1@tiMainString = tiMainString
  opt_xy1 = True
    opt_xy1@gsnString = "x"
    opt_xy1@legend_mean = False

  ks = 24
  ke = 33

  xx1 = UPW(ks:)
  yy1 = ZW(ks:)
  labels1 = UPW@long_name
  plot_xy01 = ignorant_xy(wks, xx1, yy1, labels1, res_xy1, opt_xy1)

  xx2 = UPA(ks:)
  yy2 = ZW(ks:)
  labels2 = UPA@long_name
  plot_xy02 = ignorant_xy(wks, xx2, yy2, labels2, res_xy1, opt_xy1)

  xx3 = (/ENT(ks:),DET(ks:),ENTmDET(ks:)/)
    xx3@units = ENT@units
  yy3 = z_full(ks:)
  labels3 = (/"ent","det","ent-det"/)
  plot_xy03 = ignorant_xy(wks, xx3, yy3, labels3, res_xy1, opt_xy1)

  xx4 = UPA(ks:)
  yy4 = ZW(ks:)
  labels4 = UPA@long_name
  plot_xy04 = ignorant_xy(wks, xx4, yy4, labels4, res_xy1, opt_xy1)

;--------
; plot
;--------
  resp = True
    resp@txString = option

  plot = new(4,"graphic")
  plot(0) = plot_xy01
  plot(1) = plot_xy02
  plot(2) = plot_xy04
  plot(3) = plot_xy03

  gsn_panel(wks,plot,(/1,3/),resp)
  opt1 = True
  trim_fig(wks_type, wks_name, opt1)

  exit

;==================
  ks = 28
  ke = kx-1
  yy = z_full(ks:ke)
  xx = th(:,ks:ke)
  labels_xy1 = new ( tx, "string" )

  ss1 = "dry SCM, Hour "
  do tt=0,tx-1
    labels_xy1(tt) = ss1+tt
  end do


;--------
; plot
;--------
  plot_xy1 = ignorant_xy(wks, xx, yy, labels_xy1, res_xy1, opt_xy1)
  opt1 = True
  trim_fig(wks_type, wks_name, opt1)


end
